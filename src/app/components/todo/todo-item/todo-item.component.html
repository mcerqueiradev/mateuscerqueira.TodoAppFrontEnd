<div
  class="todo-item p-4 border border-gray-200 rounded-lg bg-white transition-all duration-200 mb-5 relative"
  [class.border-blue-300]="isEditing || loading"
  [class.opacity-75]="loading"
>
  <!-- Loading Indicator -->
  <div *ngIf="loading" class="flex items-center justify-center mb-3">
    <div
      class="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"
    ></div>
    <span class="ml-2 text-sm text-blue-600">Updating...</span>
  </div>

  <!-- Info Message -->
  <div
    *ngIf="info"
    class="mb-3 p-2 bg-blue-50 border border-blue-200 rounded-md"
  >
    <div class="flex items-center">
      <span class="text-blue-600 mr-2"
        ><svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 16 16"
          fill="currentColor"
          class="size-4"
        >
          <path
            fill-rule="evenodd"
            d="M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z"
            clip-rule="evenodd"
          />
        </svg>
      </span>
      <p class="text-blue-700 text-sm">{{ info }}</p>
    </div>
  </div>

  <!-- Success Message -->
  <div
    *ngIf="success"
    class="p-5 bg-green-50 border border-green-200 rounded-md absolute top-0 left-0 h-full w-full flex items-center justify-center z-10"
  >
    <div class="flex items-center">
      <span class="text-green-600 mr-2"
        ><svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 16 16"
          fill="currentColor"
          class="size-4"
        >
          <path
            fill-rule="evenodd"
            d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.844-8.791a.75.75 0 0 0-1.188-.918l-3.7 4.79-1.649-1.833a.75.75 0 1 0-1.114 1.004l2.25 2.5a.75.75 0 0 0 1.15-.043l4.25-5.5Z"
            clip-rule="evenodd"
          />
        </svg>
      </span>
      <p class="text-green-700 text-sm">{{ success }}</p>
    </div>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="error"
    class="mb-3 p-2 bg-red-50 border border-red-200 rounded-md absolute top-0 left-0 h-full w-full flex items-center justify-center z-10"
  >
    <div class="flex items-center">
      <span class="text-red-600 mr-2"
        ><svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 16 16"
          fill="currentColor"
          class="size-4"
        >
          <path
            fill-rule="evenodd"
            d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm2.78-4.22a.75.75 0 0 1-1.06 0L8 9.06l-1.72 1.72a.75.75 0 1 1-1.06-1.06L6.94 8 5.22 6.28a.75.75 0 0 1 1.06-1.06L8 6.94l1.72-1.72a.75.75 0 1 1 1.06 1.06L9.06 8l1.72 1.72a.75.75 0 0 1 0 1.06Z"
            clip-rule="evenodd"
          />
        </svg>
      </span>
      <p class="text-red-700 text-sm">{{ error }}</p>
    </div>
  </div>

  <div *ngIf="!isEditing; else editMode">
    <div
      class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-5"
    >
      <!-- Checkbox and Task Info -->
      <div class="flex items-start sm:items-center gap-5 flex-1 min-w-0 w-full">
        <div
          class="items-center gap-2 text-xs font-medium text-gray-400 cursor-pointer hover:text-blue-600 hover:bg-blue-50 p-2 rounded-md transition-colors hidden md:flex"
        >
          <label class="flex items-center cursor-pointer relative">
            <input
              type="checkbox"
              [checked]="todo.isCompleted"
              (change)="toggleComplete()"
              [disabled]="loading"
              class="peer size-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-blue-600 checked:border-blue-600"
              id="check1"
            />
            <span
              class="absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="size-2"
                viewBox="0 0 20 20"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="1"
              >
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </span>
          </label>
        </div>

        <div
          class="todo-info flex flex-col sm:flex-row sm:items-center justify-between flex-1 min-w-0 gap-3 sm:gap-0"
        >
          <!-- Title + Description -->
          <div
            class="border-b sm:border-b-0 sm:border-r sm:pr-5 sm:mr-5 border-gray-200 flex-1 min-w-0 pb-2 sm:pb-0"
          >
            <h3
              [class.line-through]="todo.isCompleted"
              [class.text-gray-400]="todo.isCompleted"
              class="text-base font-bold text-gray-800 truncate"
            >
              {{ todo.title }}
            </h3>
            <p
              *ngIf="todo.description"
              class="text-xs font-medium text-gray-600 line-clamp-1"
            >
              {{ todo.description }}
            </p>
          </div>

          <!-- Metadata -->
          <div
            class="hidden text-xs md:flex flex-col sm:flex-row gap-2 sm:gap-5 items-start sm:items-center text-gray-400"
          >
            <div
              class="flex items-center gap-1.5 border-gray-200 sm:border-r sm:pr-5"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
                fill="currentColor"
                class="size-4"
              >
                <path
                  d="M5.75 7.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM5 10.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0ZM10.25 7.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM7.25 8.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0ZM8 9.5A.75.75 0 1 0 8 11a.75.75 0 0 0 0-1.5Z"
                />
                <path
                  fill-rule="evenodd"
                  d="M4.75 1a.75.75 0 0 0-.75.75V3a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2V1.75a.75.75 0 0 0-1.5 0V3h-5V1.75A.75.75 0 0 0 4.75 1ZM3.5 7a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v4.5a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1V7Z"
                  clip-rule="evenodd"
                />
              </svg>
              {{ todo.createdAt | date : "MMM dd, yyyy" }}
            </div>

            <div
              *ngIf="hasUserName()"
              class="flex items-center gap-1.5 sm:border-r sm:pr-5 sm:mr-5 border-gray-200"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
                fill="currentColor"
                class="size-4"
              >
                <path
                  fill-rule="evenodd"
                  d="M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0Zm-5-2a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM8 9c-1.825 0-3.422.977-4.295 2.437A5.49 5.49 0 0 0 8 13.5a5.49 5.49 0 0 0 4.294-2.063A4.997 4.997 0 0 0 8 9Z"
                  clip-rule="evenodd"
                />
              </svg>
              {{ getUserName() }}
            </div>
          </div>

          <!-- Actions -->
          <div class="flex space-x-2 mt-2 sm:mt-0 items-center">
            <div
              class="flex items-center gap-2 text-xs font-medium text-gray-400 cursor-pointer hover:text-blue-600 hover:bg-blue-50 p-2 rounded-md transition-colors md:hidden"
            >
              <label class="flex items-center cursor-pointer relative">
                <input
                  type="checkbox"
                  [checked]="todo.isCompleted"
                  (change)="toggleComplete()"
                  [disabled]="loading"
                  class="peer size-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-blue-600 checked:border-blue-600"
                  id="check1"
                />
                <span
                  class="absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="size-2"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    stroke="currentColor"
                    stroke-width="1"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </span>
              </label>
              <span>Completed</span>
            </div>

            <button
              (click)="startEdit()"
              class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors text-xs flex items-center gap-1 font-medium flex-1 justify-center"
              title="Edit task"
              [disabled]="loading"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                />
              </svg>
              <span class="md:hidden">Edit</span>
            </button>
            <button
              (click)="deleteTodo()"
              class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors text-xs flex items-center gap-1 font-medium flex-1 justify-center"
              title="Delete task"
              [disabled]="loading"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                />
              </svg>
              <span class="md:hidden">Delete</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Mode -->
  <ng-template #editMode>
    <div class="edit-form space-y-3">
      <h1 class="text-xs italic font-medium text-gray-400">
        Editing "{{ todo.title }}" task...
      </h1>
      <input
        type="text"
        [(ngModel)]="editTitle"
        placeholder="Task title"
        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        [disabled]="loading"
      />
      <textarea
        [(ngModel)]="editDescription"
        placeholder="Description (optional)"
        rows="2"
        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        [disabled]="loading"
      ></textarea>
      <div class="flex space-x-2">
        <button
          (click)="saveEdit()"
          [disabled]="!editTitle.trim() || loading"
          class="px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50"
        >
          Save
        </button>
        <button
          (click)="cancelEdit()"
          class="px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50"
          [disabled]="loading"
        >
          Cancel
        </button>
      </div>
    </div>
  </ng-template>
</div>
