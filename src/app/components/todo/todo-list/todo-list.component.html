<div class="">
  <!-- Header e Estatísticas -->
  <div
    class="p-5 md:pl-10 border-b border-gray-200 md:flex items-center justify-between"
  >
    <h1 class="text-2xl font-bold text-gray-900 mb-5 text-center md:text-left">
      My Tasks
    </h1>

    <div *ngIf="todos.length > 0" class="grid grid-cols-1 md:grid-cols-3 gap-5">
      <!-- Total -->
      <div class="bg-white border border-gray-200 rounded-2xl p-5">
        <p class="text-xs text-gray-500 font-medium">Total</p>
        <p class="text-2xl font-bold text-gray-900">{{ getStats().total }}</p>
      </div>

      <!-- Completed -->
      <div class="bg-white border border-gray-200 rounded-2xl p-5">
        <p class="text-xs text-gray-500 font-medium">Completed</p>
        <p class="text-2xl font-bold text-green-600">
          {{ getStats().completed }}
        </p>
      </div>

      <!-- Pending -->
      <div class="bg-white border border-gray-200 rounded-2xl p-5">
        <p class="text-xs text-gray-500 font-medium">Pending</p>
        <p class="text-2xl font-bold text-blue-600">{{ getStats().pending }}</p>
      </div>
    </div>
  </div>

  <!-- Filtros e Busca -->
  <div
    class="py-5 px-5 md:px-10 border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-5"
  >
    <div class="flex space-x-2">
      <button
        [class.bg-blue-100]="filter === 'all'"
        [class.text-blue-700]="filter === 'all'"
        (click)="onFilterChange('all')"
        class="px-3 py-1.5 rounded-md text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-50"
      >
        All
      </button>
      <button
        [class.bg-blue-100]="filter === 'pending'"
        [class.text-blue-700]="filter === 'pending'"
        (click)="onFilterChange('pending')"
        class="px-3 py-1.5 rounded-md text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-50"
      >
        Pending
      </button>
      <button
        [class.bg-blue-100]="filter === 'completed'"
        [class.text-blue-700]="filter === 'completed'"
        (click)="onFilterChange('completed')"
        class="px-3 py-1.5 rounded-md text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-50"
      >
        Completed
      </button>
    </div>
    <!--  Barra de Busca -->
    <div class="relative w-full sm:w-64">
      <input
        type="text"
        placeholder="Search for tasks..."
        [value]="searchTerm"
        (input)="onSearchChange($any($event.target).value)"
        class="w-full rounded-md border border-gray-300 pl-10 pr-4 py-2 text-sm text-gray-700 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none"
      />
      <svg
        class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-4.35-4.35M16.65 16.65A7 7 0 1110 3a7 7 0 016.65 13.65z"
        />
      </svg>
    </div>
  </div>

  <!-- Loading -->
  <app-loading
    *ngIf="loading"
    message="Loading tasks, please wait..."
  ></app-loading>

  <!-- Error -->
  <app-error
    *ngIf="error && !loading"
    [message]="error"
    [showRetry]="true"
    (retry)="retryLoad()"
  ></app-error>

  <!-- Lista de Tarefas -->
  <div *ngIf="!loading && !error">
    <div *ngIf="filteredTodos.length === 0" class="text-center py-36">
      <ng-container *ngIf="todos.length === 0; else noResults">
        <h3 class="text-lg font-semibold text-gray-700">No tasks found</h3>
        <p class="text-sm text-gray-500">Start by creating your first task!</p>
      </ng-container>

      <ng-template #noResults>
        <h3 class="text-lg font-semibold text-gray-700">
          No tasks match the filters
        </h3>
        <p class="text-sm text-gray-500">
          Try adjusting the filters or search terms.
        </p>
      </ng-template>
    </div>

    <div class="px-5 md:px-10 pb-5" *ngIf="filteredTodos.length > 0">
      <app-todo-item
        *ngFor="let todo of filteredTodos; trackBy: trackByTodoId"
        [todo]="todo"
        (deleted)="onTodoDeleted($event)"
        (updated)="onTodoUpdated($event)"
      ></app-todo-item>
    </div>
  </div>

  <!-- Paginação -->
  <div
    *ngIf="!loading && !error && totalPages > 1"
    class="px-4 py-4 border-t border-gray-200 flex flex-col gap-3 items-center justify-between text-center sm:flex-row sm:text-left sm:gap-0"
  >
    <button
      (click)="changePage(currentPage - 1)"
      [disabled]="!hasPreviousPage || loading"
      class="px-3 py-2 text-sm rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 disabled:opacity-50 w-full sm:w-auto"
    >
      ← Previous
    </button>

    <span class="text-sm text-gray-500">
      Page
      <span class="font-semibold text-gray-900">{{ currentPage }}</span> of
      <span class="font-semibold text-gray-900">{{ totalPages }}</span>
      <span *ngIf="totalCount > 0"> ({{ totalCount }} items in total)</span>
    </span>

    <button
      (click)="changePage(currentPage + 1)"
      [disabled]="!hasNextPage || loading"
      class="px-3 py-2 text-sm rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 disabled:opacity-50 w-full sm:w-auto"
    >
      Next →
    </button>
  </div>
</div>
